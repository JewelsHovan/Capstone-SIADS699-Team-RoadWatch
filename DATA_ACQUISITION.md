# Data Acquisition Guide

This guide explains how to obtain the required data sources for the Texas Crash Prediction project.

## Required Data Sources

The project requires 2 primary data sources:

1. Kaggle US Accidents Dataset (2.8GB) - Crash records
2. HPMS Texas 2023 (1.1GB) - Road characteristics with AADT traffic data

## Prerequisites

```bash
# Clone repository
git clone <repository-url>
cd Capstone

# Create virtual environment
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# Install project
pip install -e .
```

## 1. Kaggle US Accidents Dataset

**Source:** Kaggle - US Accidents (2016-2023)
**URL:** https://www.kaggle.com/datasets/sobhanmoosavi/us-accidents
**Size:** 2.8GB (CSV file)
**License:** CC BY-NC-SA 4.0

### Option A: Download via Kaggle CLI

```bash
# Install Kaggle CLI
pip install kaggle

# Setup Kaggle API credentials
# 1. Go to https://www.kaggle.com/settings
# 2. Create API token (downloads kaggle.json)
# 3. Move to ~/.kaggle/kaggle.json (Linux/Mac) or %USERPROFILE%\.kaggle\kaggle.json (Windows)

# Download dataset
kaggle datasets download -d sobhanmoosavi/us-accidents

# Extract and filter to Texas
unzip us-accidents.zip
python -c "
import pandas as pd
df = pd.read_csv('US_Accidents_March23.csv')
tx = df[df['State'] == 'TX']
tx.to_csv('data/bronze/texas/crashes/kaggle_us_accidents_texas.csv', index=False)
print(f'Saved {len(tx):,} Texas crashes')
"
```

### Option B: Manual Download

1. Visit https://www.kaggle.com/datasets/sobhanmoosavi/us-accidents
2. Click Download (requires Kaggle account)
3. Extract ZIP file
4. Filter to Texas:
   ```python
   import pandas as pd
   df = pd.read_csv('US_Accidents_March23.csv')
   tx_crashes = df[df['State'] == 'TX']
   tx_crashes.to_csv('data/bronze/texas/crashes/kaggle_us_accidents_texas.csv', index=False)
   ```

### Expected Output

- File: `data/bronze/texas/crashes/kaggle_us_accidents_texas.csv`
- Size: 2.8GB
- Rows: 466,000 Texas crashes (2016-2023)

## 2. HPMS Texas 2023

**File:** `data/silver/texas/roadway/hpms_texas_2023.gpkg`
**Size:** 1.1GB
**Format:** GeoPackage (spatial data)

This file contains:

- 971,000+ Texas road segments
- Road characteristics: speed limit, lanes, functional classification
- AADT traffic counts (integrated from national HPMS)
- Geometry (LineString) for spatial joins

### Option A: Direct Download (Recommended)

1. Download from Google Drive (Accessible to anyone from University of Michigan):
   https://drive.google.com/file/d/1CQNea7fRKMghZpWlCf66fJwBYS4is4YC/view?usp=drive_link

2. Place the file in:
   ```
   data/silver/texas/roadway/hpms_texas_2023.gpkg
   ```

### Option B: Regenerate from National HPMS (Advanced)

This process requires downloading 14GB of national data and takes 2-3 hours.

**Steps:**

1. Download National HPMS 2023
   - Source: Bureau of Transportation Statistics (BTS)
   - URL: https://geodata.bts.gov/datasets/national-highway-planning-network
   - Download: `HPMS2023.gdb` (14GB)
   - Place in: `data/bronze/texas/HPMS2023.gdb`

2. Extract Texas data

   ```bash
   python data_engineering/download/download_hpms_texas.py --file data/bronze/texas/HPMS2023.gdb
   ```

3. Output: `data/silver/texas/roadway/hpms_texas_2023.gpkg` (1.1GB)

## Directory Structure

After acquiring data:

```
data/
├── bronze/
│   └── texas/
│       └── crashes/
│           └── kaggle_us_accidents_texas.csv  (2.8GB)
│
├── silver/
│   └── texas/
│       └── roadway/
│           └── hpms_texas_2023.gpkg  (1.1GB)
│
└── gold/
    └── ml_datasets/
        └── crash_level/
            ├── train_latest.csv  (generated by pipeline)
            ├── val_latest.csv
            └── test_latest.csv
```

## Verification

Run verification script to check data:

```bash
PYTHONPATH=. python scripts/verify_data.py
```

Expected output:

```
Kaggle crashes found: 466,190 rows
HPMS Texas found: 971,244 road segments
Ready to run data pipeline
```

## Next Steps

After data acquisition:

```bash
# Run data pipeline
PYTHONPATH=. python scripts/run_pipeline.py

# Train models
PYTHONPATH=. python -m ml_engineering.train_with_mlflow --dataset crash --model all

# Launch application
streamlit run app/Home.py
```

## Data Citations

**US Accidents Dataset:**

```
Moosavi, Sobhan, Mohammad Hossein Samavatian, Srinivasan Parthasarathy,
and Rajiv Ramnath. "A Countrywide Traffic Accident Dataset.", 2019.
```

**HPMS Data:**

```
U.S. Department of Transportation, Federal Highway Administration.
Highway Performance Monitoring System (HPMS), 2023.
```
